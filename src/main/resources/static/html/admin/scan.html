<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"      xmlns:th="http://www.thymeleaf.org"><head>    <meta charset="UTF-8">    <!-- 引入样式 -->    <link rel="stylesheet" href="https://unpkg.com/mint-ui/lib/style.css">    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">    <!-- 先引入 Vue -->    <script src="https://unpkg.com/vue/dist/vue.js"></script>    <script src="/js/jquery-1.10.2.js"></script>    <!-- 引入组件库 -->    <script src="https://unpkg.com/mint-ui/lib/index.js"></script>    <script src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script></head><body><div id="app" class="page-field">    <mt-header fixed title="实验台--学生注册"></mt-header>    <div class="page-header-main">        <div class="page-title">实验台--学生注册</div>        <mt-field label="学号" placeholder="请输入学号" v-model="usercode" type="text" :attr="{ maxlength: 20 }"></mt-field>        <mt-field label="姓名" placeholder="请输入姓名" v-model="username" type="text" :attr="{ maxlength: 20 }"></mt-field>        <mt-field label="电话" placeholder="请输入电话" v-model="userphone" type="tel"></mt-field>        <mt-button @click.native="showClasses" size="large" v-text="className"></mt-button>        <mt-button @click.native="showSheet" size="large">上传头像</mt-button>        <img v-if="showimg" v-lazy="picpath" style="width: 100%; height: 300px; margin: auto;">        <div align="center">        <mt-button @click.native="handleClick">按钮</mt-button>        </div>        <!--<mt-actionsheet :actions="actions" v-model="sheetVisible"></mt-actionsheet>-->        <mt-actionsheet :actions="classes" v-model="classVisible"></mt-actionsheet>        <input type="hidden" th:value="${sign}" id="wxconfig"/>        <input type="hidden" th:value="${classes}" id="classes"/>    </div></div></body><script>    var wxconfig;    try {        wxconfig=JSON.parse($("#wxconfig").val());        wx.config({            debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。            appId: wxconfig.appId, // 必填，公众号的唯一标识            timestamp: wxconfig.timestamp, // 必填，生成签名的时间戳            nonceStr: wxconfig.nonceStr, // 必填，生成签名的随机串            signature: wxconfig.signature,// 必填，签名            jsApiList: ['chooseImage', 'previewImage', 'uploadImage', 'downloadImage'] // 必填，需要使用的JS接口列表        });    }catch (ex){        console.log(ex)    }    var classes=[];    if($("#classes").val()!=""){        var d= JSON.parse($("#classes").val());        $(d).each(function (index,item) {            classes.push({                name:item.classname,                method:function () {                    vue.className=item.classname;                    vue.classId=item.id;                }            })        })    }   var vue=  new Vue({        el: '#app',        data:{            usercode:"",            username:"",            userphone:"",            facepic:"",            picpath:"",            showimg:false,            className:"选择班级",            classId:0,            sheetVisible:false,            // actions:[{            //     name: '拍照',            //     method: this.takePhoto            // }, {            //     name: '从相册中选择',            //     method: this.openAlbum            // }],            classVisible:false,            classes:classes        },        methods: {            handleClick: function() {                var obj=this;                if(this.username==""){                    this.$toast('学生姓名不能为空')                    return false;                }                if(this.usercode==""){                    this.$toast('学号不能为空')                    return false;                }                if(this.facepic==""){                    this.$toast('请上传一张人脸照片')                    return false;                }                if(this.classId==0){                    this.$toast('请选择班级')                    return false;                }                var d={                    id:0,                    username:this.username,                    userphone:this.userphone,                    usercode:this.usercode,                    facepic:this.facepic,                    classid:this.classId                }                //console.log(d);                $.ajax({url:"/admin/scanAddUser",contentType: 'application/json;charset=utf-8',type: "POST",dataType:"json",data:JSON.stringify(d)                    ,success:function (data) {                        if(data&&data.code==1){                            obj.$toast(data.msg);                            obj.username="";                            obj.userphone="";                            obj.usercode="";                            obj.facepic="";                            obj.className="选择班级";                            obj.classId=0;                            obj.showimg=false;                            obj.picpath=""                        }else{                            obj.$toast("注册失败："+data.msg);                        }                    }})            },            showSheet:function () {                var obj=this;                wx.chooseImage({                    count: 1, // 默认9                    sizeType: ['original', 'compressed'],                    sourceType: ['album', 'camera'],                    success: function (res) {                        var localIds = res.localIds;                        wx.getLocalImgData({                            localId: localIds[0], // 图片的localID                            success: function (res) {                                var localData = res.localData; // localData是图片的base64数据，可以用img标签显示                                //$("#img").attr("src",localData);                                obj.picpath=localData;                                obj.showimg=true;                                Pic = localData.replace(/^data:image\/(png|jpg);base64,/,"")                                Pic = localData.replace(/^data:image\/jgp;base64,/,"")                                $.ajax({                                    url:"/admin/uploadImgBase64",                                    type:"post",                                    contentType: 'application/x-www-form-urlencoded;charset=utf-8',                                    data:{ "imageData" : Pic},                                    success:function(data){                                        console.log(data);                                        if(data.code==1){                                            //$("#picpath").text(data.data)                                            obj.facepic=data.data;                                        }else{                                            obj.$toast("上传图片失败")                                            //$("#picpath").text("上传图片失败")                                        }                                    }                                });                            }                        });                    }                });            },            takePhoto:function () {                            },            openAlbum:function () {                            },            showClasses:function () {              this.classVisible=true;            }        }    })</script></html>