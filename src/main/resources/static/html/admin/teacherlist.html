<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>实验台管理-教师管理</title>
    <link rel="stylesheet" href="/html/admin/css/style.default.css" type="text/css" />
    <script src="/js/jquery-1.10.2.js"></script>

    <!--[if IE 9]>
    <link rel="stylesheet" media="screen" href="/html/admin/css/style.ie9.css"/>
    <![endif]-->
    <!--[if IE 8]>
    <link rel="stylesheet" media="screen" href="/html/admin/css/style.ie8.css"/>
    <![endif]-->
    <!--[if lt IE 9]>
    <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
    <![endif]-->
</head>

<body class="withvernav">
<div class="bodywrapper">
    <div th:include="html/admin/inner :: copyheader ('teacher')"></div>

    <div class="centercontent">

        <div class="pageheader">
            <h1 class="pagetitle">教师管理</h1>
            <span class="pagedesc">The content below are loaded using ajax</span>

            <ul class="hornav">
                <li class="current"><a>教师管理</a></li>
                <li><a id="add" href="/admin/addteacher">添加教师</a></li>
            </ul>
        </div><!--pageheader-->

        <div id="contentwrapper" class="contentwrapper">

            <div id="inbox" class="subcontent">

                <div class="msghead">
                    <ul class="msghead_menu">
                        <li class="marginleft5"><a class="msgtrash" title="Trash"></a></li>
                        <li class="right"><a class="next"></a></li>
                        <li class="right"><a class="prev"></a></li>
                        <li class="right"><span class="pageinfo">1-10 of 2,139</span></li>
                    </ul>
                    <span class="clearall"></span>
                </div><!--msghead-->

                <table cellpadding="0" cellspacing="0" border="0" class="stdtable mailinbox">
                    <colgroup>
                        <col class="con1" width="4%"/>
                        <col class="con0" width="4%" />
                        <col class="con1" width="15%"/>
                        <col class="con0" width="13%"/>
                        <col class="con1" width="14%"/>
                        <col class="con0" width="10%"/>
                    </colgroup>
                    <thead>
                    <tr>
                        <th width="20" class="head1 aligncenter"><input type="checkbox" name="checkall" class="checkall" /></th>
                        <th class="head0">id</th>
                        <th class="head1">登录名</th>
                        <th class="head0">教师名称</th>
                        <th class="head1">密码</th>
                        <th class="head0">操作</th>
                    </tr>
                    </thead>
                    <tfoot>
                    <tr>
                        <th class="head1 aligncenter"><input type="checkbox" name="checkall" class="checkall2" /></th>
                        <th class="head0">id</th>
                        <th class="head1">登录名</th>
                        <th class="head0">教师名称</th>
                        <th class="head1">密码</th>
                        <th class="head0">操作</th>
                    </tr>
                    </tfoot>
                    <tbody id="userlist">
                    </tbody>
                </table>
            </div>
            <div id="compose" class="subcontent" style="display: none">&nbsp;</div>
        </div><!--contentwrapper-->

    </div><!--centercontent-->
    
</div><!--bodywrapper-->
<script type="text/javascript">
    $(function () {
        var dataList,totalList,pageindex=1,pagesize=20,pagenum=0;
        $.ajax({url:"/admin/getteacherlist",success:function(result){
                if(result&&result.code==1&&result.data&&result.data.length>0) {
                    dataList=totalList=result.data;
                    pagenum=dataList.length;
                    page(pageindex);
                }
            }});
        function page() {
            $("#userlist").empty();
            var start=(pageindex-1)*pagesize;
            var end=pageindex*pagesize;
            var size=parseInt(pagenum/pagesize)+1
            $(".pageinfo").text(pageindex+ "-"+size+" of "+pagenum)
            dataList.forEach(function (item,index) {
                if(index>=start&&index<end){
                    var unread = (index % 2 == 0 ? "unread" : "");
                    binduser(item, unread);
                }
            })
            bindclick()
        }
        $(".next").click(function () {
            pageindex+=(pageindex*pagesize)>pagenum?0:1;
            page();
        })
        $(".prev").click(function () {
            pageindex-=pageindex<=1?0:1;
            page();
        })
        $(".submitbutton").click(function () {
            var txt=$("#keyword").val();
            var newlist=[]
            if(txt==""){
                newlist=totalList;
            }else{
                totalList.forEach(function (item,index) {
                    if(item.usercode&&item.usercode.indexOf(txt)>=0){
                        newlist.push(item)
                    }
                    if(item.username&&item.username.indexOf(txt)>=0){
                        newlist.push(item)
                    }
                    if(item.classname&&item.classname.indexOf(txt)>=0){
                        newlist.push(item)
                    }
                    if(item.userphone&&item.userphone.indexOf(txt)>=0){
                        newlist.push(item)
                    }
                })
            }
            dataList=newlist;
            pageindex=1;
            pagenum=dataList.length;
            page();

        })
        function binduser(data,unread) {
            var userhtml="<tr class=\""+unread+"\">\n" +
                "                            <td class=\"aligncenter\"><input type=\"checkbox\" name=\"\" /></td>\n" +
                "                            <td class=\"aligncenter\">{id}</td>\n" +
                "                            <td>{loginname}</td>\n" +
                "                            <td><a href=\"\" class=\"title\">{username}</a></td>\n" +
                "                            <td class=\"attachment\">{loginpwd}</td>\n" +
                "                            <td class=\"date\"><a val='{id}' t='update' class=\"btn btn4 btn_link\"></a><a val='{id}' t='del' class=\"btn btn4 btn_trash\"></a></td>\n" +
                "                        </tr>";
            userhtml=userhtml.replace("{id}",data.id)
            userhtml=userhtml.replace("{id}",data.id)
            userhtml=userhtml.replace("{id}",data.id)
            userhtml=userhtml.replace("{loginname}",data.loginname)
            userhtml=userhtml.replace("{username}",data.username)
            userhtml=userhtml.replace("{loginpwd}",data.loginpwd)
            $("#userlist").append(userhtml)
        }
        function bindclick() {
            $("a[t='read']").each(function () {
                if(!$(this).attr("val")||$(this).attr("val")==""||$(this).attr("val")=="undefined"){
                    $(this).hide()
                }
            })
            $("a[t='load']").each(function () {
                if(!$(this).attr("val")||$(this).attr("val")==""||$(this).attr("val")=="undefined"){
                    $(this).hide()
                }
            })
            $("a[t='del']").click(function () {
                console.log($(this).attr("val"))
                if(confirm("确定删除？")) {
                    var id = $(this).attr("val")
                    $.ajax({
                        url: "/admin/deluser", data: {id: id}, success: function (result) {
                            if (result && result.code == 1) {
                                alert("删除成功");
                                location.href = location.href;
                            } else {
                                alert("删除失败")
                            }
                        }
                    });
                }
                return false;
            })
            $("a[t='update']").click(function () {
                var id = $(this).attr("val")
                location.href="/admin/addteacher?id="+id;
            })
        }
    })
</script>
</body>
</html>
