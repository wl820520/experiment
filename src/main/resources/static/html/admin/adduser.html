<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"      xmlns:th="http://www.thymeleaf.org"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>实验台管理-学生管理</title><link rel="stylesheet" href="/html/admin/css/style.default.css" type="text/css" /><!--<script type="text/javascript" src="/html/admin/js/plugins/jquery-1.7.min.js"></script>--><!--<script type="text/javascript" src="/html/admin/js/plugins/jquery-ui-1.8.16.custom.min.js"></script>--><!--<script type="text/javascript" src="/html/admin/js/plugins/jquery.cookie.js"></script>--><!--<script type="text/javascript" src="/html/admin/js/plugins/jquery.uniform.min.js"></script>--><!--<script type="text/javascript" src="/html/admin/js/plugins/jquery.validate.min.js"></script>--><!--<script type="text/javascript" src="/html/admin/js/plugins/jquery.tagsinput.min.js"></script>--><!--<script type="text/javascript" src="/html/admin/js/plugins/charCount.js"></script>--><!--<script type="text/javascript" src="/html/admin/js/plugins/ui.spinner.min.js"></script>--><!--<script type="text/javascript" src="/html/admin/js/plugins/chosen.jquery.min.js"></script>--><!--<script type="text/javascript" src="/html/admin/js/custom/general.js"></script>--><!--<script type="text/javascript" src="/html/admin/js/custom/forms.js"></script>-->    <script src="/js/jquery-1.10.2.js"></script><!--[if IE 9]>    <link rel="stylesheet" media="screen" href="/html/admin/css/style.ie9.css"/><![endif]--><!--[if IE 8]>    <link rel="stylesheet" media="screen" href="/html/admin/css/style.ie8.css"/><![endif]--><!--[if lt IE 9]>	<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script><![endif]--></head><body class="withvernav"><div class="bodywrapper">    <div th:include="html/admin/inner :: copyheader ('user')"></div>    <div class="centercontent">        <div class="pageheader">            <h1 class="pagetitle">学生管理</h1>            <span class="pagedesc">添加学生</span>                        <ul class="hornav">                <li><a href="/admin/user">学生管理</a></li>                <li class="current"><a>添加学生</a></li>                <li><a href="/admin/compereuserface">识别学生</a></li>            </ul>        </div><!--pageheader-->                <div id="contentwrapper" class="contentwrapper">            <form id="form1" class="stdform">            <div id="validation" class="subcontent">                    	<p>                        	<label>登录账号</label>                            <span class="field"><input type="text" name="address" id="loginname" class="longinput" /></span>                        </p>                <p>                    <label>登录密码</label>                    <span class="field"><input type="text" name="address" id="loginpwd" class="longinput" /></span>                </p>                        <p>                        	<label>学号</label>                            <span class="field"><input type="text" name="address" id="usercode" class="longinput" /></span>                        </p>                                                <p>                        	<label>授权码</label>                            <span class="field"><input type="text" name="address" id="usersign" class="longinput" /></span>                        </p>                <p>                    <label>学生姓名</label>                    <span class="field"><input type="text" name="address" id="username" class="longinput" /></span>                </p>                <p>                    <label>学生电话</label>                    <span class="field"><input type="text" name="address" id="userphone" class="longinput" /></span>                </p>                <p>                    <label>学生照片</label>                    <br class="field">                            	<input type="file" name="pic" id="pic" /><br/>                        <span id="picpath"></span><br />                                <img id="img" width="150px" height="150px" />                </p>                        <br />                        <input id="id" name="id" value="0" type="hidden" />                        <input id="jsonval" name="jsonval" th:value="${userInfo}" type="hidden"/>                <p class="stdformbutton">                    <a class="stdbtn btn_blue">提交</a>                </p>            </div><!--subcontent-->            </form>        </div><!--contentwrapper-->        	</div><!-- centercontent -->    <script type="text/javascript">        $(function () {            var base64="";            if($("#jsonval").val()&&$("#jsonval").val()!="") {                var data = JSON.parse($("#jsonval").val());                $("#id").val(data.id);                $("#loginname").val(data.loginname);                $("#loginpwd").val(data.loginpwd);                $("#username").val(data.username);                $("#userphone").val(data.userphone);                $("#usersign").val(data.usersign);                $("#usercode").val(data.usercode);                $("#picpath").text("http://pic.justh5.com"+data.facepic);                //console.log(location.hash+data.facepic)                $("#img").attr("src","http://pic.justh5.com"+data.facepic)            }            $("#pic").change(function(){                var file = this.files[0];                if(!/image\/\w+/.test(file.type)){                    alert("文件必须为图片！");                    return false;                }                $("#img").attr("src",URL.createObjectURL($(this)[0].files[0]));                var reader = new FileReader();                reader.readAsDataURL(file);                reader.onload = function (e) { base64= this.result; }                var file = document.querySelector('[type=file]');                // 通过FormData将文件转成二进制数据                var formData = new FormData();                // 将文件转二进制                formData.append('pic', file.files[0]);                console.log(formData)                // var req = new XMLHttpRequest();                // req.open("post", "/admin/uploadpic", false);                // req.send(formData,function (d) {                //     console.log(d);                // });                $.ajax({                    url:"/admin/uploadface",                    type:"post",                    data:formData,                    processData:false,                    contentType:false,                    success:function(data){                        console.log(data);                        if(data.code==1){                            $("#picpath").text(data.data)                        }else{                            $("#picpath").text("上传图片失败")                        }                    }                });            });            $(".stdformbutton").click(function () {                if($("#loginname").val()==""){                    alert("登录名称不能为空")                    return false;                }                if($("#loginpwd").val()==""){                    alert("登录密码不能为空")                    return false;                }                if($("#usercode").val()==""){                    alert("学号不能为空")                    return false;                }                var d={                    id:$("#id").val(),                    loginname:$("#loginname").val(),                    loginpwd:$("#loginpwd").val(),                    username:$("#username").val(),                    userphone:$("#userphone").val(),                    usersign:$("#usersign").val(),                    usercode:$("#usercode").val(),                    facepic:$("#picpath").text(),                    roleid:3                }                //console.log(d);                $.ajax({url:"/admin/addusermodel",contentType: 'application/json;charset=utf-8',type: "POST",dataType:"json",data:JSON.stringify(d)                        ,success:function (data) {                    if(data&&data.code==1){                        alert("恭喜您添加成功")                        location.href=location.href;                    }else{                        alert("添加失败："+data.msg)                    }                }})            })        })    </script>    </div><!--bodywrapper--></body></html>