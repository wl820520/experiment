<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"      xmlns:th="http://www.thymeleaf.org"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>实验台管理-主页</title><link rel="stylesheet" href="/html/admin/css/style.default.css" type="text/css" />    <script src="/js/jquery-1.10.2.js"></script><!--[if IE 9]>    <link rel="stylesheet" media="screen" href="/html/admin/css/style.ie9.css"/><![endif]--><!--[if IE 8]>    <link rel="stylesheet" media="screen" href="/html/admin/css/style.ie8.css"/><![endif]--><!--[if lt IE 9]>	<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script><![endif]--></head><body class="withvernav"><div class="bodywrapper">    <div th:include="html/admin/inner :: copyheader ('experiment')"></div>    <div class="centercontent">        <div class="pageheader">            <h1 class="pagetitle">实验管理</h1>            <span class="pagedesc">添加实验</span>                        <ul class="hornav">                <li><a href="/admin/experiment">实验管理</a></li>                <li class="current"><a>添加实验</a></li>            </ul>        </div><!--pageheader-->                <div id="contentwrapper" class="contentwrapper">            <form id="form1" class="stdform">            <div id="validation" class="subcontent">                    	<p>                        	<label>实验类型</label>                            <span class="field"><select id="selexperiment"><option value="0">实验一</option><option value="1">实验二</option><option value="2">实验三</option><option value="3">实验四</option><option value="4">复习</option><option value="5">考试</option></select></span>                        </p>                                                <p>                        	<label>实验名称</label>                            <span class="field"><input type="text" name="address" id="experimentname" class="longinput" /></span>                        </p>                        <p>                        	<label>试题内容</label>                            <span class="field"><textarea rows="50" cols="10" id="experimentvalue"></textarea></span>                        </p>                <p>                    <label>上传图片</label>                    <br class="field">                            	<input type="file" name="pic" id="pic" /><br/>                        <span id="picpath"></span><br />                                <img id="img" width="150px" height="150px" />                            </span>                </p>                        <br />                        <input id="id" name="id" value="0" type="hidden" />                        <input id="jsonval" name="jsonval" th:value="${exMainEntity}" type="hidden"/>                        <p class="stdformbutton">                        	<a class="submit radius2">提交</a>                        </p>            </div><!--subcontent-->            </form>        </div><!--contentwrapper-->        	</div><!-- centercontent -->    <script type="text/javascript">        $(function () {            var base64="";            if($("#jsonval").val()&&$("#jsonval").val()!="") {                var data = JSON.parse($("#jsonval").val());                console.log(data);                $("#id").val(data.id);                $("#experimentvalue").val(JSON.stringify(JSON.parse(data.json_value), null, 4));                $("#experimentname").val(data.content)                $("#selexperiment").val(data.main_type)            }            $("#pic").change(function(){                var file = this.files[0];                if(!/image\/\w+/.test(file.type)){                    alert("文件必须为图片！");                    return false;                }                $("#img").attr("src",URL.createObjectURL($(this)[0].files[0]));                var reader = new FileReader();                reader.readAsDataURL(file);                reader.onload = function (e) { base64= this.result; }                var file = document.querySelector('[type=file]');                // 通过FormData将文件转成二进制数据                var formData = new FormData();                // 将文件转二进制                formData.append('pic', file.files[0]);                console.log(formData)                // var req = new XMLHttpRequest();                // req.open("post", "/admin/uploadpic", false);                // req.send(formData,function (d) {                //     console.log(d);                // });                $.ajax({                    url:"http://123.56.255.65:8099/admin/uploadpic",                    type:"post",                    data:formData,                    processData:false,                    contentType:false,                    success:function(data){                        console.log(data);                        if(data.code==1){                            $("#picpath").text(data.data)                        }else{                            $("#picpath").text("上传图片失败")                        }                    }                });            });            $(".stdformbutton").click(function () {                if($("#experimentname").val()==""){                    alert("实验名称不能为空")                    return false;                }                // console.log($("#experimentvalue").val())                // console.log($("#experimentvalue").text())                if($("#experimentvalue").val()==""){                    alert("试题内容不能为空")                    return false;                }                try {                    var d = JSON.parse($("#experimentvalue").val())                    if(!d){                        alert("试题内容json格式错误")                        return false;                    }                }catch(ex) {                    alert("试题内容json格式错误")                    return false;                }                var d={                    id:$("#id").val(),                    main_type:$("#selexperiment").val(),                    content:$("#experimentname").val(),                    title:$("#selexperiment").find("option:selected").text(),                    json_value:$("#experimentvalue").val()                }                //console.log(d);                $.ajax({url:"/admin/saveExMain",contentType: 'application/json;charset=utf-8',type: "POST",dataType:"json",data:JSON.stringify(d)                        ,success:function (data) {                    if(data&&data.code==1){                        alert("恭喜您添加成功")                        location.href=location.href;                    }else{                        alert("添加失败："+data.msg)                    }                }})            })        })        // $.ajax({url:"/hotel/getCount",success:function(result){        //     var num1=0,num2=0;        //         if(result&&result.data&&result.data.length>0) {        //             result.data.forEach(function (item,index) {        //                 switch (index){        //                     case 0:        //                         num2=item;        //                         break;        //                     case 1:        //                         num1=item;        //                         break;        //                     case 3:        //                         $("#usernum").text(item)        //                         break;        //                 }        //             })        //             console.log(num1+"   "+num2)        //             var rat=parseFloat(num2/num1).toFixed(2)*100;        //             $("#userrat").text(rat+"%")        //         }        //     }});        //获取url中的参数        // function getQueryString(name) {        //     var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); // 匹配目标参数        //     var result = window.location.search.substr(1).match(reg); // 对querystring匹配目标参数        //     if (result != null) {        //         return decodeURIComponent(result[2]);        //     } else {        //         return null;        //     }        // }        // var id=getQueryString("id")        // if(parseInt(id)>0) {        //     $.ajax({        //         url: "/hotel/getHotelById", data: {hotelid: id}, success: function (result) {        //             var num1 = 0, num2 = 0;        //             if (result && result.data && result.data.hotel) {        //                 $("#hotelname").val(result.data.hotel.hotelname)        //                 $("#address").val(result.data.hotel.address)        //                 $("#note").val(result.data.hotel.note);        //                 $("#id").val(id);        //                 console.log(result.data.hotel.pic)        //                 // $("#pic").val(result.data.experiment.pic);        //                 $("#img").attr("src",result.data.hotel.pic);        //                 if(result.data.hotel.ishot==1){        //                     $("#ishot").attr("checked",true);        //                 }else{        //                     $("#ishot").attr("checked",true);        //                 }        //             }        //         }        //     });        // }    </script>    </div><!--bodywrapper--></body></html>