<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"      xmlns:th="http://www.thymeleaf.org"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>实验台--用户注册</title><link rel="stylesheet" href="/html/admin/css/style.default.css" type="text/css" />    <script src="/js/jquery-1.10.2.js"></script><script src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><!--[if IE 9]>    <link rel="stylesheet" media="screen" href="/html/admin/css/style.ie9.css"/><![endif]--><!--[if IE 8]>    <link rel="stylesheet" media="screen" href="/html/admin/css/style.ie8.css"/><![endif]--><!--[if lt IE 9]>	<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script><![endif]--></head><body class="withvernav"><div class="bodywrapper">    <div class="topheader">        <div class="left">            <h1 class="logo">实验台.<span>学生扫码注册</span></h1>            <span class="slogan">学生注册系统</span>            <div class="search">                <form action="" method="post">                    <input type="text" name="keyword" id="keyword" value="请输入" />                    <button class="submitbutton"></button>                </form>            </div><!--search-->            <br clear="all" />        </div><!--left-->    </div><!--topheader-->    <div class="centercontent">        <div class="pageheader">            <h1 class="pagetitle">学生扫码注册</h1>            <ul class="hornav">                <li class="current"><a>学生扫码注册</a></li>            </ul>        </div><!--pageheader-->                <div id="contentwrapper" class="contentwrapper">            <div class="stdform">            <div id="validation" class="subcontent">                        <p>                        	<label>学号</label>                            <span class="field"><input type="text" name="address" id="usercode" class="longinput" /></span>                        </p>                <p>                    <label>学生姓名</label>                    <span class="field"><input type="text" name="address" id="username" class="longinput" /></span>                </p>                <p>                    <label>学生电话</label>                    <span class="field"><input type="text" name="address" id="userphone" class="longinput" /></span>                </p>                <p>                    <label>学生照片</label>                    <button id="phone" class="btn btn4 btn_help">拍照</button><br />                    <!--<button id="getImg" class="btn btn4 btn_help">拍照</button>-->                            	<!--<input type="file" accept="image/*;" style="display: none" capture="camera"  name="pic" id="pic" /><br/>-->                        <span id="picpath"></span><br />                    <div>                        <!--<video id="video" width="430" height="325" autoplay></video>-->                        <!--<canvas id="canvas" width="430" height="325"></canvas>-->                        <img id="img" width="430px" height="325px" />                    </div>                </p>                <p class="stdformbutton">                    <a class="stdbtn btn_blue">提交</a>                </p>            </div><!--subcontent-->            </div>        </div><!--contentwrapper-->        <input type="hidden" th:value="${sign}" id="wxconfig"/>	</div><!-- centercontent -->    <script type="text/javascript">        $(function () {            var wxconfig;            try {                wxconfig= JSON.parse($("#wxconfig").val());                wx.config({                    debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。                    appId: wxconfig.appId, // 必填，公众号的唯一标识                    timestamp: wxconfig.timestamp, // 必填，生成签名的时间戳                    nonceStr: wxconfig.nonceStr, // 必填，生成签名的随机串                    signature: wxconfig.signature,// 必填，签名                    jsApiList: ['chooseImage', 'previewImage', 'uploadImage', 'downloadImage'] // 必填，需要使用的JS接口列表                });            }catch (ex){                console.log(ex)            }            //var videoObj = { "video": true },video = document.getElementById("video"),canvas = document.getElementById("canvas"),context = canvas.getContext("2d");//getContext唯一合法值2d;            $("#phone").click(function () {                $.ajax({                    url:"/admin/uploadImgBase64",                    type:"post",                    data:{ "imageData" : base64},                    success:function(data){                        console.log(data);                        if(data.code==1){                            $("#picpath").text(data.data)                        }else{                            $("#picpath").text("上传图片失败")                        }                    }                });                // wx.chooseImage({                //     count: 1, // 默认9                //     sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有                //     sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有                //     success: function (res) {                //         var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片                //         //$("#img").attr("src",localIds);                //         console.log(res);                //         wx.getLocalImgData({                //             localId: localIds[0], // 图片的localID                //             success: function (res) {                //                 var localData = res.localData; // localData是图片的base64数据，可以用img标签显示                //                 $("#img").attr("src",localData);                //                 Pic = localData.replace(/^data:image\/(png|jpg);base64,/,"")                //                 Pic = localData.replace(/^data:image\/jgp;base64,/,"")                //                 $.ajax({                //                     url:"/admin/uploadImgBase64",                //                     type:"post",                //                     data:{ "imageData" : Pic},                //                     success:function(data){                //                         console.log(data);                //                         if(data.code==1){                //                             $("#picpath").text(data.data)                //                         }else{                //                             $("#picpath").text("上传图片失败")                //                         }                //                     }                //                 });                //             }                //         });                //         // wx.uploadImage({                //         //     localId: localIds[0], // 需要上传的图片的本地ID，由chooseImage接口获得                //         //     isShowProgressTips: 1, // 默认为1，显示进度提示                //         //     success: function (res) {                //         //         var serverId = res.serverId; // 返回图片的服务器端ID                //         //                 $.ajax({                //         //                     url:"/admin/downloadImg",                //         //                     type:"post",                //         //                     data:{ "server_id" : serverId},                //         //                     success:function(data){                //         //                         console.log(data);                //         //                         if(data.code==1){                //         //                             $("#picpath").text(data.data)                //         //                         }else{                //         //                             $("#picpath").text("微信下载图片失败")                //         //                         }                //         //                     }                //         //                 });                //         //     }                //         // });                //     }                // });                // var canvas = document.getElementById("canvas"),                //     context = canvas.getContext("2d"),                //     video = document.getElementById("video"),                //     videoObj = {                //         "video": true                //     },                //     errBack = function(error) {                //         console.log("Video capture error: ", error.code);                //     };                //                // // 设置video监听器                // if (navigator.getUserMedia) { // Standard                //     navigator.getUserMedia(videoObj, function(stream) {                //         video.src = stream;                //         video.play();                //     }, errBack);                // } else if (navigator.webkitGetUserMedia) { // WebKit-prefixed                //     navigator.webkitGetUserMedia(videoObj, function(stream) {                //         video.src = window.webkitURL.createObjectURL(stream);                //         video.play();                //     }, errBack);                // }            })            // $("#getImg").click(function () {                 //drawImage方法：http://blog.csdn.net/u012193330/article/details/44996923            //     context.drawImage(video, 0, 0, 430, 325);            //     uploadpic();            // })            // function uploadpic() {            //     var Pic = document.getElementById("canvas").toDataURL("image/jpg");            //     $("#img").attr("src",Pic);            //     //对其进行base64编 之后的字符串            //     Pic = Pic.replace(/^data:image\/(png|jpg);base64,/,"")            //     $.ajax({            //         url:"/admin/uploadImgBase64",            //         type:"post",            //         data:{ "imageData" : Pic},            //         success:function(data){            //             console.log(data);            //             if(data.code==1){            //                 $("#picpath").text(data.data)            //             }else{            //                 $("#picpath").text("上传图片失败")            //             }            //         }            //     });            // }            // $("#pic").change(function(){            //     var file = this.files[0];            //     if(!/image\/\w+/.test(file.type)){            //         alert("文件必须为图片！");            //         return false;            //     }            //     $("#img").attr("src",URL.createObjectURL($(this)[0].files[0]));            //     var reader = new FileReader();            //     reader.readAsDataURL(file);            //     reader.onload = function (e) { base64= this.result; }            //     var file = document.querySelector('[type=file]');            //     // 通过FormData将文件转成二进制数据            //     var formData = new FormData();            //     // 将文件转二进制            //     formData.append('pic', file.files[0]);            //     console.log(formData)            //     // var req = new XMLHttpRequest();            //     // req.open("post", "/admin/uploadpic", false);            //     // req.send(formData,function (d) {            //     //     console.log(d);            //     // });            //     $.ajax({            //         url:"/admin/uploadpic",            //         type:"post",            //         data:formData,            //         processData:false,            //         contentType:false,            //         success:function(data){            //             console.log(data);            //             if(data.code==1){            //                 $("#picpath").text(data.data)            //             }else{            //                 $("#picpath").text("上传图片失败")            //             }            //         }            //     });            // });            $(".stdformbutton").click(function () {                if($("#username").val()==""){                    alert("学生姓名不能为空")                    return false;                }                if($("#usercode").val()==""){                    alert("学号不能为空")                    return false;                }                var d={                    id:0,                    username:$("#username").val(),                    userphone:$("#userphone").val(),                    usercode:$("#usercode").val(),                    facepic:$("#picpath").text()                }                //console.log(d);                $.ajax({url:"/admin/scanAddUser",contentType: 'application/json;charset=utf-8',type: "POST",dataType:"json",data:JSON.stringify(d)                        ,success:function (data) {                    if(data&&data.code==1){                        alert("恭喜您注册成功")                        location.href=location.href;                    }else{                        alert("注册失败："+data.msg)                    }                }})            })        })    </script>    </div><!--bodywrapper--></body></html>