<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"      xmlns:th="http://www.thymeleaf.org"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>实验台--刷脸</title><link rel="stylesheet" href="/html/admin/css/style.default.css" type="text/css" />    <script src="/js/jquery-1.10.2.js"></script><script src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><!--[if IE 9]>    <link rel="stylesheet" media="screen" href="/html/admin/css/style.ie9.css"/><![endif]--><!--[if IE 8]>    <link rel="stylesheet" media="screen" href="/html/admin/css/style.ie8.css"/><![endif]--><!--[if lt IE 9]>	<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script><![endif]-->    <style>        #canvas,#video {            float: left;            margin-right: 10px;            background: #fff;        }        .box {            overflow: hidden;            margin-bottom: 10px;        }    </style></head><body class="withvernav"><div class="bodywrapper">    <div class="topheader">        <div class="left">            <h1 class="logo">实验台.<span>学生刷脸</span></h1>            <span class="slogan">学生注册系统</span>            <br clear="all" />        </div><!--left-->    </div><!--topheader-->    <div class="centercontent">        <div class="pageheader">            <h1 class="pagetitle">学生刷脸</h1>            <ul class="hornav">                <li class="current"><a>学生刷脸验证</a></li>            </ul>        </div><!--pageheader-->                <div id="contentwrapper" class="contentwrapper">            <div class="stdform">            <div id="validation" class="subcontent">                        <p>                        	<label>学号</label>                            <span class="field"><input type="text" name="address" id="usercode" class="longinput" /></span>                        </p>                <p>                    <label>学生照片</label>                    <button id="phone" class="btn btn4 btn_help">拍照</button><br />                    <span id="picpath"></span><br />                    <div>                        <img id="img" width="430px" height="325px" />                    </div>                </p>                <p>                <div class="box">                    <video id="video" width="400" height="300"></video>                    <canvas id="canvas"></canvas>                </div>                </p>                <p class="stdformbutton">                    <a class="stdbtn btn_blue">提交</a>                </p>                <p class="stdformbutton">                    <a id="shibie" class="stdbtn btn_blue">识别</a>                </p>            </div><!--subcontent-->            </div>        </div><!--contentwrapper-->	</div><!-- centercontent -->    <script type="text/javascript">        $(function () {            var video = document.getElementById('video');            var canvas = document.getElementById('canvas');            var ctx = canvas.getContext('2d');            var width = video.width;            var height = video.height;            canvas.width = width;            canvas.height = height;            $("#shibie").click(function () {                var URL = window.URL || window.webkitURL;   // 获取到window.URL对象                navigator.getUserMedia({                    video: true                }, function(stream){                    video.src = URL.createObjectURL(stream);   // 将获取到的视频流对象转换为地址                    video.play();   // 播放                    //点击截图                    document.getElementById("snap").addEventListener('click', function() {                        ctx.drawImage(video, 0, 0, width, height);                        var url = canvas.toDataURL('image/png');                        document.getElementById('download').href = url;                    });                }, function(error){                    console.log(error.name || error);                });            });            function scanface() {            }            //var videoObj = { "video": true },video = document.getElementById("video"),canvas = document.getElementById("canvas"),context = canvas.getContext("2d");//getContext唯一合法值2d;            $("#phone").click(function () {                $.ajax({                    url: "/admin/uploadImgBase64",                    type: "post",                    data: {"imageData": base64},                    success: function (data) {                        console.log(data);                        if (data.code == 1) {                            $("#picpath").text(data.data)                        } else {                            $("#picpath").text("上传图片失败")                        }                    }                });                $(".stdformbutton").click(function () {                    if ($("#usercode").val() == "") {                        alert("学号不能为空")                        return false;                    }                    var d = {                        id: 0,                        usercode: $("#usercode").val(),                        facepic: $("#picpath").text()                    }                    //console.log(d);                    $.ajax({                        url: "/admin/updateuserpic",                        contentType: 'application/json;charset=utf-8',                        type: "POST",                        dataType: "json",                        data: JSON.stringify(d)                        ,                        success: function (data) {                            if (data && data.code == 1) {                                alert("恭喜您上传图片成功")                                location.href = location.href;                            } else {                                alert("注册失败：" + data.msg)                            }                        }                    })                })            })        })    </script>    </div><!--bodywrapper--></body></html>