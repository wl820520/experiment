<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>产品列表页面</title>
<link rel="stylesheet" href="/html/admin/css/style.default.css" type="text/css" />
<!--<script type="text/javascript" src="/html/admin/js/plugins/jquery-1.7.min.js"></script>-->
<!--<script type="text/javascript" src="/html/admin/js/plugins/jquery-ui-1.8.16.custom.min.js"></script>-->
<!--<script type="text/javascript" src="/html/admin/js/plugins/jquery.cookie.js"></script>-->
<!--<script type="text/javascript" src="/html/admin/js/custom/general.js"></script>-->
<!--<script type="text/javascript" src="/html/admin/js/custom/productlist.js"></script>-->

    <script src="/html/hotel/js/jquery-2.1.4.min.js"></script>
<!--[if IE 9]>
    <link rel="stylesheet" media="screen" href="/html/admin/css/style.ie9.css"/>
<![endif]-->
<!--[if IE 8]>
    <link rel="stylesheet" media="screen" href="/html/admin/css/style.ie8.css"/>
<![endif]-->
<!--[if lt IE 9]>
	<script src="/html/admin/js/plugins/css3-mediaqueries.js"></script>
<![endif]-->
</head>

<body class="withvernav">
<div class="bodywrapper">
    <div class="topheader">
        <div class="left">
            <h1 class="logo">酒店.<span>后台管理系统</span></h1>
            <span class="slogan">后台管理系统</span>

            <div class="search">
                <form action="" method="post">
                    <input type="text" name="keyword" id="keyword" value="请输入" />
                    <button class="submitbutton"></button>
                </form>
            </div><!--search-->

            <br clear="all" />

        </div><!--left-->

        <div class="right">
            <!--<div class="notification">
                <a class="count" href="ajax/notifications.html"><span>9</span></a>
            </div>-->
            <div class="userinfo">
                <img src="/html/admin/images/thumbs/avatar.png" alt="" />
                <span>管理员</span>
            </div><!--userinfo-->

            <div class="userinfodrop">
                <div class="avatar">
                    <a href=""><img src="/html/admin/images/thumbs/avatarbig.png" alt="" /></a>
                    <div class="changetheme">
                        切换主题: <br />
                        <a class="default"></a>
                        <a class="blueline"></a>
                        <a class="greenline"></a>
                        <a class="contrast"></a>
                        <a class="custombg"></a>
                    </div>
                </div><!--avatar-->
                <div class="userdata">
                    <h4>Juan</h4>
                    <span class="email">youremail@yourdomain.com</span>
                    <ul>
                        <li><a href="editprofile.html">编辑资料</a></li>
                        <li><a href="accountsettings.html">账号设置</a></li>
                        <li><a href="help.html">帮助</a></li>
                        <li><a href="index.html">退出</a></li>
                    </ul>
                </div><!--userdata-->
            </div><!--userinfodrop-->
        </div><!--right-->
    </div><!--topheader-->


    <div class="header">
        <ul class="headermenu">
            <li><a href="/admin/dashboard"><span class="icon icon-flatscreen"></span>首页</a></li>
            <li><a href="/admin/hotel"><span class="icon icon-pencil"></span>酒店管理</a></li>
            <li><a href="/admin/user"><span class="icon icon-message"></span>会员管理</a></li>
            <li class="current"><a href="/admin/order"><span class="icon icon-message"></span>订单管理</a></li>
            <li><a href="/admin/report"><span class="icon icon-chart"></span>统计报表</a></li>
        </ul>

        <div class="headerwidget">
            <div class="earnings">
                <div class="one_half">
                    <h4>入住人数</h4>
                    <h2 id="usernum"></h2>
                </div><!--one_half-->
                <div class="one_half last alignright">
                    <h4>入住率</h4>
                    <h2 id="userrat"></h2>
                </div><!--one_half last-->
            </div><!--earnings-->
        </div><!--headerwidget-->

    </div><!--header-->
    <div class="vernav2 iconmenu">
        <ul>
            <li><a href="/admin/hotel" class="gallery">酒店管理</a></li>
            <li><a href="/admin/user" class="elements">会员管理</a></li>
            <li><a href="/admin/order" class="calendar">订单管理</a></li>
            <li><a href="/admin/report" class="widgets">统计信息</a></li>
        </ul>
        <a class="togglemenu"></a>
        <br /><br />
    </div><!--leftmenu-->
    <div class="centercontent">

        <div class="pageheader">
            <h1 class="pagetitle">订单管理</h1>
            <span class="pagedesc">The content below are loaded using ajax</span>

            <ul class="hornav">
                <li class="current"><a>订单管理</a></li>
            </ul>
        </div><!--pageheader-->

        <div id="contentwrapper" class="contentwrapper">

            <div id="inbox" class="subcontent">

                <div class="msghead">
                    <ul class="msghead_menu">
                        <li class="marginleft5"><a class="msgtrash" title="Trash"></a></li>
                        <li class="right"><a class="next"></a></li>
                        <li class="right"><a class="prev prev_disabled"></a></li>
                        <li class="right"><span class="pageinfo">1-10 of 2,139</span></li>
                    </ul>
                    <span class="clearall"></span>
                </div><!--msghead-->

                <table cellpadding="0" cellspacing="0" border="0" class="stdtable mailinbox">
                    <colgroup>
                        <col class="con1" width="4%"/>
                        <col class="con0" width="4%" />
                        <col class="con1" width="15%"/>
                        <col class="con0" width="20%"/>
                        <col class="con1" width="4%"/>
                        <col class="con1" width="4%"/>
                        <col class="con1" width="4%"/>
                        <col class="con1" width="10%"/>
                    </colgroup>
                    <thead>
                    <tr>
                        <th width="20" class="head1 aligncenter"><input type="checkbox" name="checkall" class="checkall" /></th>
                        <th class="head0">订单id</th>
                        <th class="head1">酒店名称</th>
                        <th class="head0">房间名称</th>
                        <th class="head1">预定时间</th>
                        <th class="head0">预定时间</th>
                        <th class="head0">当前状态</th>
                        <th class="head1">结算订单</th>
                    </tr>
                    </thead>
                    <tfoot>
                    <tr>
                        <th class="head1 aligncenter"><input type="checkbox" name="checkall" class="checkall2" /></th>
                        <th class="head0">订单id</th>
                        <th class="head1">酒店名称</th>
                        <th class="head0">房间名称</th>
                        <th class="head1">预定时间</th>
                        <th class="head0">预定时间</th>
                        <th class="head0">当前状态</th>
                        <th class="head1">结算订单</th>
                    </tr>
                    </tfoot>
                    <tbody id="userlist">
                    </tbody>
                </table>
            </div>
            <div id="compose" class="subcontent" style="display: none">&nbsp;</div>
        </div><!--contentwrapper-->

    </div><!--centercontent-->
    
</div><!--bodywrapper-->
<script type="text/javascript">
    $(function () {
        $.ajax({url:"/order/getOrderList",success:function(result){
                if(result&&result.code==1&&result.data&&result.data.length>0) {
                    $("#userlist").empty();
                    result.data.forEach(function (item,index) {
                        var unread=(index%2==0?"unread":"");
                        binduser(item,unread);
                    })
                    bindclick();
                }
            }});
        function binduser(data,unread) {
            var userhtml="<tr class=\""+unread+"\">\n" +
                "                            <td class=\"aligncenter\"><input type=\"checkbox\" name=\"\" /></td>\n" +
                "                            <td class=\"aligncenter\">{id}</td>\n" +
                "                            <td>{hotelname}</td>\n" +
                "                            <td><a href=\"\" class=\"title\">{roomname}</a></td>\n" +
                "                            <td class=\"attachment\">{starttime}</td>\n" +
                "                            <td class=\"date\">{endtime}</td>\n" +
                "                            <td class=\"date\">{status}</td>\n" +
                "                            <td class=\"date\"><a val='{id}' t='link' style='background-image: none' class=\"stdbtn btn_black\">退房</a></td>\n" +
                "                        </tr>";
            userhtml=userhtml.replace("{id}",data.id)
            userhtml=userhtml.replace("{hotelname}",data.hotelname)
            userhtml=userhtml.replace("{roomname}",data.roomname)
            userhtml=userhtml.replace("{starttime}",data.starttime)
            userhtml=userhtml.replace("{endtime}",data.endtime)
            userhtml=userhtml.replace("{status}",data.isdelete==0?"预定成功":"已退房")
            userhtml=userhtml.replace("{id}",data.id)
            $("#userlist").append(userhtml)
        }
        function bindclick() {
            $("a[t='link']").click(function () {
                var id=$(this).attr("val");
                if(confirm("是否确定退房")){
                    $.ajax({url:"/order/updateOrderStatus",data:{id:id},success:function(result){
                            var num1=0,num2=0;
                            if(result&&result.code==1) {
                                alert("退房成功");
                                location.href=location.href;
                            }else{
                                alert("退房失败："+result.msg);
                            }
                        }});
                }
            })
        }
    })

    $.ajax({url:"/hotel/getCount",success:function(result){
            var num1=0,num2=0;
            if(result&&result.data&&result.data.length>0) {
                result.data.forEach(function (item,index) {
                    switch (index){
                        case 0:
                            num2=item;
                            break;
                        case 1:
                            num1=item;
                            break;
                        case 3:
                            $("#usernum").text(item)
                            break;
                    }
                })
                console.log(num1+"   "+num2)
                var rat=parseFloat(num2/num1).toFixed(2)*100;
                $("#userrat").text(rat+"%")
            }
        }});
</script>
</body>
</html>
