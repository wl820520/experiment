<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title></title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<meta name="author" content="" />
  	<!-- Facebook and Twitter integration -->
	<meta property="og:title" content=""/>
	<meta property="og:image" content=""/>
	<meta property="og:url" content=""/>
	<meta property="og:site_name" content=""/>
	<meta property="og:description" content=""/>
	<meta name="twitter:title" content="" />
	<meta name="twitter:image" content="" />
	<meta name="twitter:url" content="" />
	<meta name="twitter:card" content="" />

		<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
		<link rel="shortcut icon" href="favicon.ico">
		<!-- <link href='https://fonts.googleapis.com/css?family=Lato:400,100,100italic,300,300italic,400italic,700italic,900,700,900italic' rel='stylesheet' type='text/css'> -->

		<!-- Stylesheets -->
		<!-- Dropdown Menu -->
		<link rel="stylesheet" href="/html/hotel/css/superfish.css">
		<!-- Owl Slider -->
		<!-- <link rel="stylesheet" href="/html/experiment/css/owl.carousel.css"> -->
		<!-- <link rel="stylesheet" href="/html/experiment/css/owl.theme.default.min.css"> -->
		<!-- Date Picker -->
		<link rel="stylesheet" href="/html/hotel/css/bootstrap-datepicker.min.css">
		<!-- CS Select -->
		<link rel="stylesheet" href="/html/hotel/css/cs-select.css">
		<link rel="stylesheet" href="/html/hotel/css/cs-skin-border.css">

		<!-- Themify Icons -->
		<link rel="stylesheet" href="/html/hotel/css/themify-icons.css">
		<!-- Flat Icon -->
		<link rel="stylesheet" href="/html/hotel/css/flaticon.css">
		<!-- Icomoon -->
		<link rel="stylesheet" href="/html/hotel/css/icomoon.css">
		<!-- Flexslider  -->
		<link rel="stylesheet" href="/html/hotel/css/flexslider.css">

		<!-- Style -->
		<link rel="stylesheet" href="/html/hotel/css/style.css">

		<link rel="stylesheet" href="/html/hotel/css/style.default.css" type="text/css" />
		<!-- Modernizr JS -->
		<script src="/html/hotel/js/modernizr-2.6.2.min.js"></script>
		<!-- FOR IE9 below -->
		<!--[if lt IE 9]>
		<script src="/html/experiment/js/respond.min.js"></script>
	<![endif]-->

</head>
<body>
	<div id="fh5co-wrapper">
	<div id="fh5co-page">
		<div id="fh5co-header">
			<header id="fh5co-header-section">
				<div class="container">
					<div class="nav-header">
						<a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
						<h1 id="loginout" style="display: none"><a>注销账号</a></h1>
						<nav id="fh5co-menu-wrap" role="navigation">
							<ul class="sf-menu" id="fh5co-primary-menu">
								<li><a href="/hotel/index">主页</a></li>
								<li>
									<a class="fh5co-sub-ddown">选择酒店</a>
									<ul class="fh5co-sub-menu">
									</ul>
								</li>
								<li><a class="active" href="/user/userInfo">会员信息</a></li>
								<li><a href="/user/contact">关于我们</a></li>
							</ul>
						</nav>
					</div>
				</div>
			</header>

		</div>
	<!-- end:fh5co-header -->
	<div class="fh5co-parallax" style="background-image: url(/html/hotel/images/slider1.jpg);" data-stellar-background-ratio="0.5">
		<div class="overlay"></div>
		<div class="container">
			<div class="row">
				<div class="col-md-12 col-md-offset-0 col-sm-12 col-sm-offset-0 col-xs-12 col-xs-offset-0 text-center fh5co-table">
					<div class="fh5co-intro fh5co-table-cell">
						<h1 class="text-center" id="username"></h1>
						<p id="userphone"></p>
						<p id="notetxt">我的预定信息</p>
					</div>
				</div>
			</div>
		</div>
	</div>
		<footer id="footer" class="fh5co-bg-color">
			<div class="container">
				<div class="row">
					<div class="col-md-3">
						<div class="copyright">
							<p><small>Copyright &copy; 2016.Company name All rights reserved.</small></p>
						</div>
					</div>
					<div class="col-md-6">
						<div class="row">
							<div class="col-md-3">
								<h3>公司信息</h3>
								<ul class="link">
									<li><a href="#">关于我们</a></li>
									<li><a href="#">酒店</a></li>
									<li><a href="#">热门房间</a></li>
									<li><a href="#">联系我们</a></li>
								</ul>
							</div>
							<!--<div class="col-md-6">-->
							<!--<h3>Subscribe</h3>-->
							<!--<p>Sed cursus ut nibh in semper. Mauris varius et magna in fermentum. </p>-->
							<!--<form action="#" id="form-subscribe">-->
							<!--<div class="form-field">-->
							<!--<input type="email" placeholder="Email Address" id="email">-->
							<!--<input type="submit" id="submit" value="Send">-->
							<!--</div>-->
							<!--</form>-->
							<!--</div>-->
						</div>
					</div>
				</div>
			</div>
		</footer>

	</div>
	<!-- END fh5co-page -->
		<div id="loginbox" class="loginbox">
			<div class="loginboxinner">

				<div class="logo">
					<h1 class="logo">酒店<span>管理系统 </span></h1>
					<span class="slogan">登录后可预定酒店</span>
				</div><!--logo-->
				<div class="nousername" style="display: none">
					<div class="loginmsg">密码不正确.</div>
				</div><!--nousername-->
				<div class="username">
					<div class="usernameinner">
						<input type="text" value="" name="username" placeholder="输入登录名" id="loginname" />
					</div>
				</div>
				<div class="password">
					<div class="passwordinner">
						<input type="password"value=""  name="password" placeholder="输入密码" id="password" />
					</div>
				</div>
				<div name="registdata" class="password" style="display: none">
					<div class="passwordinner">
						<input type="password"value=""  name="password" placeholder="重复密码" id="prepassword" />
					</div>
				</div>
				<div name="registdata" class="username" style="display: none">
					<div class="usernameinner">
						<input type="text" name="username" placeholder="输入简称" id="username" />
					</div>
				</div>
				<div name="registdata" class="username" style="display: none">
					<div class="usernameinner">
						<input type="text" name="username" placeholder="输入手机号码" id="userphone" />
					</div>
				</div>
				<div name="logindata"><button id="login">登录</button></div>
				<div name="registdata" style="display: none"><button id="regist">注册</button></div>
				<div name="logindata" class="keep" id="toregist"><a>我要注册</a> </div>
				<div name="registdata" class="keep" id="tologin" style="display: none"><a> 我有账号</a></div>

			</div><!--loginboxinner-->
		</div><!--loginbox-->

		<div id="close">关闭弹框</div>
		<div id="cover"></div>
	</div>
	<!-- END fh5co-wrapper -->

	<!-- Javascripts -->
	<script src="/html/hotel/js/jquery-2.1.4.min.js"></script>
	<!-- Dropdown Menu -->
	<!--<script src="/html/experiment/js/hoverIntent.js"></script>-->
	<!--<script src="/html/experiment/js/superfish.js"></script>-->
	<script src="/html/hotel/js/bootstrap.min.js"></script>
	<!-- Waypoints -->
	<script src="/html/hotel/js/jquery.waypoints.min.js"></script>
	<!-- Counters -->
	<script src="/html/hotel/js/jquery.countTo.js"></script>
	<!-- Stellar Parallax -->
	<script src="/html/hotel/js/jquery.stellar.min.js"></script>
	<!-- Owl Slider -->
	<!-- // <script src="/html/experiment/js/owl.carousel.min.js"></script> -->
	<!-- Date Picker -->
	<script src="/html/hotel/js/bootstrap-datepicker.min.js"></script>
	<!-- CS Select -->
	<script src="/html/hotel/js/classie.js"></script>
<script>
$(function () {
    if(localStorage["islogin"]&&localStorage["islogin"]!="") {
        userinfo=JSON.parse(localStorage["userid"]);
        $("#loginout").show();
    }
    var userinfo;
    if(localStorage["islogin"]&&localStorage["islogin"]!="") {
        userinfo =JSON.parse(localStorage["userid"]);
        $("#notetxt").text("您未预定任何酒店");
        $("#username").text(userinfo.username)
        $("#userphone").text(userinfo.userphone)
        $.ajax({url:"/order/getOrderListByUid",data:{uid:userinfo.id},success:function(result){
                if(result&&result.code==1) {
                    var ordername="您预定了 ";
                    result.data.forEach(function (item,index) {
                        if(item.starttime&&item.starttime!=null) {
                            ordername += (item.hotelname == "" ? item.roomname : item.hotelname) + " 入住时间：" + item.starttime + " 预计离开时间：" + item.endtime;
                        }
                    })
                    $("#notetxt").text(ordername);
                }else{
                    $(".nousername").show();
                }
            }});
    }else{
        $("#notetxt").text("请登录后查看预定信息");
        showlogin()
        $(".loginbox").show();
        $("#cover").show();
	}
})
</script>

	<script>
        $.ajax({url:"/hotel/getHotelList",success:function(result){
                $(".fh5co-sub-menu").empty();
                $("#hothotel").empty();
                $("#selecthotel").html("<option value='0' disabled selected>选择酒店</option>");
                if(result.data&&result.data.length>0){
                    result.data.forEach(function (item,index) {
                        var html="<li><a href=\"/hotel/hotel?hotelid="+item.id+"\">"+item.hotelname+"</a></li>";
                        var op="<option value=\""+item.id+"\">"+item.hotelname+"</option>";
                        $(".fh5co-sub-menu").append(html);
                        $("#selecthotel").append(op);
                        if(item.ishot==1) {
                            gethothotel(item)
                        }
                    });
                    bindorderclick(1)
                    var script=document.createElement("script");
                    script.type="text/javascript";
                    script.src="/html/hotel/js/selectFx.js";
                    document.getElementsByTagName('head')[0].appendChild(script);
                    script.onload=function () {
                        [].slice.call( document.querySelectorAll( 'select.cs-select' ) ).forEach( function(el) {
                            new SelectFx(el);
                        } );
                    }
                    var script2=document.createElement("script");
                    script2.type="text/javascript";
                    script2.src="/html/hotel/js/jquery.flexslider-min.js";
                    document.getElementsByTagName('head')[0].appendChild(script2);
                    var script3=document.createElement("script");
                    script3.type="text/javascript";
                    script3.src="/html/hotel/js/custom.js";
                    document.getElementsByTagName('head')[0].appendChild(script3);
                }
            }})
        function gethothotel(data) {
            var lihtml="<li style=\"background-image: url({img});\">\n" +
                "\t\t   \t\t<div class=\"overlay-gradient\"></div>\n" +
                "\t\t   \t\t<div class=\"container\">\n" +
                "\t\t   \t\t\t<div class=\"col-md-12 col-md-offset-0 text-center slider-text\">\n" +
                "\t\t   \t\t\t\t<div class=\"slider-text-inner js-fullheight\">\n" +
                "\t\t   \t\t\t\t\t<div class=\"desc\">\n" +
                "\t\t   \t\t\t\t\t\t<p><span>{hotelname}</span></p>\n" +
                "\t\t   \t\t\t\t\t\t<h2>{hotelnote}</h2>\n" +
                "\t\t\t   \t\t\t\t\t<p>\n" +
                "\t\t\t   \t\t\t\t\t\t<a class=\"btn btn-primary btn-lg\" val='{hotelid}' toname='{hotelname}' name='toorder'>预定</a>\n" +
                "\t\t\t   \t\t\t\t\t</p>\n" +
                "\t\t   \t\t\t\t\t</div>\n" +
                "\t\t   \t\t\t\t</div>\n" +
                "\t\t   \t\t\t</div>\n" +
                "\t\t   \t\t</div>\n" +
                "\t\t   \t</li>";
            lihtml=lihtml.replace("{img}",data.pic)
            lihtml=lihtml.replace("{hotelname}",data.hotelname)
            lihtml=lihtml.replace("{hotelname}",data.hotelname)
            lihtml=lihtml.replace("{hotelnote}",data.note)
            lihtml=lihtml.replace("{hotelid}",data.id)
            $("#hothotel").append(lihtml);
        }

        function bindorderclick(type) {
            $("a[name='toorder']").bind("click",function () {
                console.log("toclick")
                if(localStorage["islogin"]&&localStorage["islogin"]!="") {
                    var id=$(this).attr("val");
                    var toname=$(this).attr("toname");
                    if(type==1){
                        createorder(userinfo.id,id,toname,0,"","","")
                    }else{
                        createorder(userinfo.id,0,"",id,toname,"","")
                    }
                }else{
                    showlogin()
                    $(".loginbox").show();
                    $("#cover").show();
                }
            })
        }
        if(localStorage["islogin"]&&localStorage["islogin"]!="") {
            $("#loginout").show();
        }
        $("#toregist").click(function () {
            $("div[name='registdata']").show();
            $("div[name='logindata']").hide();
        });
        $("#tologin").click(function () {
            $("div[name='registdata']").hide();
            $("div[name='logindata']").show();
        });
        $("#loginout").click(function () {
            localStorage["islogin"]="";
            $("#loginout").hide();
        })
        $("#regist").click(function () {
            if($("#loginname").val()==""){
                alert("登录不能为空");return;
            }
            if($("#password").val()==""){
                alert("密码不能为空");return;
            }
            if($("#password").val()!=$("#prepassword").val()){
                alert("两次输入密码不一致");return;
            }
            $.ajax({url:"/user/regist",data:{loginname:$("#loginname").val(),loginpwd:$("#password").val(),username:$("#username").val(),userphone:$("#userphone").val()},success:function(result){
                    if(result&&result.code==1) {
                        alert("恭喜您注册成功");
                        $("div[name='registdata']").hide();
                        $("div[name='logindata']").show();
                    }else{
                        alert("注册失败"+result.msg);
                    }
                }});
        })

        function createorder(userid,hotelid,hotelname,roomid,roomname,starttime,endtime) {
            $.ajax({url:"/order/addorder",data:{userid:userid, hotelid:hotelid,hotelname:hotelname,roomid:roomid,roomname:roomname,starttime:starttime,endtime:endtime},success:function(result){
                    if(result&&result.code==1) {
                        alert("预定成功")
                        $(".loginbox").hide();
                        $("#cover").hide();
                    }else{
                        alert("预定失败")
                    }
                }});

        }
        $("#login").click(function () {
            $.ajax({url:"/user/login",data:{loginname:$("#loginname").val(),loginpwd:$("#password").val()},success:function(result){
                    if(result&&result.code==1) {
                        getuserinfo(result);
                      }else{
                        $(".nousername").show();
                    }
                }});
        })
		function getuserinfo(result) {
            $("#notetxt").text("您未预定任何酒店");
            $("#username").text(result.data.username)
            $("#userphone").text(result.data.userphone)
            localStorage["islogin"]="true"
            $("#loginout").show();
            localStorage["userid"]=JSON.stringify(result.data);
            userinfo=result.data;
            $.ajax({url:"/order/getOrderListByUid",data:{uid:result.data.id},success:function(result){
                    if(result&&result.code==1) {
                        var ordername="您预定了 ";
                        result.data.forEach(function (item,index) {
                            ordername+=(item.hotelname==""?item.roomname:item.hotelname)+" 入住时间："+item.starttime+" 预计离开时间："+item.endtime;
                        })
                        $("#notetxt").text(ordername);
                        $(".loginbox").hide();
                        $("#cover").hide();
                    }else{
                        $(".nousername").show();
                    }
                }});
        }
        $(".btn").bind("click",function (event) {
            showlogin()
            $(".loginbox").show();
            $("#cover").show();
        })
        $(window).resize(function() {
            showlogin()
        });
        function showlogin() {
            screenWidth = $(window).width();
            screenHeight = $(window).height();
            scrolltop = $(document).scrollTop();
            objLeft = (screenWidth - $(".loginbox").width()) / 2;
            objTop = (screenHeight - $(".loginbox").height()) / 2 + scrolltop;
            $(".loginbox").css({left: objLeft + 'px', top: objTop + 'px', 'display': 'block'});
        }
        $(window).scroll(function() {
            if($(".loginbox").css("display")!='none') {
                showlogin()
            }
        });
        $("#cover").click(function () {
            $(".loginbox").hide();
            $(this).hide();
        })
	</script>
</body>
</html>